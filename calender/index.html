<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elarc Ella - Room Availability</title>
    <style>
        .room-calendar {
            margin: 20px auto;
            max-width: 900px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .room-title {
            color: #2E86AB;
            margin-bottom: 15px;
        }
        .calendar-display {
            min-height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        .refresh-btn {
            background-color: #FF5A5F;
            color: white;
            border: none;
            padding: 8px 15px;
            margin-top: 10px;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="room-calendar">
        <h2 class="room-title">Deluxe Double Room</h2>
        <div class="calendar-display" id="deluxe-calendar">
            <!-- Calendar will load here -->
            <p>Loading calendar data...</p>
        </div>
        <button class="refresh-btn" onclick="loadICal('deluxe-calendar', 'https://www.airbnb.com/calendar/ical/1481728211224541449.ics?s=0601aa47422f6413b80411df5cb18045')">
            Refresh Calendar
        </button>
    </div>

    <div class="room-calendar">
        <h2 class="room-title">Family Suite</h2>
        <div class="calendar-display" id="suite-calendar">
            <!-- Calendar will load here -->
            <p>Loading calendar data...</p>
        </div>
        <button class="refresh-btn" onclick="loadICal('suite-calendar', 'https://www.airbnb.com/calendar/ical/1483159189092150712.ics?s=41eaaab7ec67b79ad74e670c090270fc')">
            Refresh Calendar
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.4.0/ical.min.js"></script>
    <script>
        // iCal දත්ත පූරණය කරන ෆන්ක්ෂන්
        async function loadICal(calendarId, icalUrl) {
            const calendarElement = document.getElementById(calendarId);
            calendarElement.innerHTML = '<p>Loading calendar data...</p>';
            
            try {
                // iCal feed ලබා ගැනීම
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(icalUrl)}`);
                const data = await response.json();
                
                // iCal දත්ත parse කිරීම
                const jcalData = ICAL.parse(data.contents);
                const comp = new ICAL.Component(jcalData);
                const vevents = comp.getAllSubcomponents('vevent');
                
                // Calendar HTML ජනනය කිරීම
                let html = '<table style="width:100%; border-collapse: collapse;">';
                html += '<tr><th>Start Date</th><th>End Date</th><th>Status</th></tr>';
                
                vevents.forEach(event => {
                    const icalEvent = new ICAL.Event(event);
                    const startDate = icalEvent.startDate.toJSDate().toLocaleDateString();
                    const endDate = icalEvent.endDate.toJSDate().toLocaleDateString();
                    const summary = icalEvent.summary;
                    
                    // අයිතමයේ තත්වය අනුව වර්ණය තීරණය කරන්න
                    const status = summary.includes('NOTAVAILABLE') ? 
                                   '<span style="color:red">Booked</span>' : 
                                   '<span style="color:green">Available</span>';
                    
                    html += `<tr>
                        <td>${startDate}</td>
                        <td>${endDate}</td>
                        <td>${status}</td>
                    </tr>`;
                });
                
                html += '</table>';
                calendarElement.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading iCal:', error);
                calendarElement.innerHTML = `<p style="color:red">Error loading calendar. <a href="${icalUrl}" target="_blank">Try downloading directly</a></p>`;
            }
        }

        // පිටුව පූරණය වන විට කැලැන්ඩර් පූරණය කරන්න
        window.onload = function() {
            loadICal('deluxe-calendar', 'https://www.airbnb.com/calendar/ical/1481728211224541449.ics?s=0601aa47422f6413b80411df5cb18045');
            loadICal('suite-calendar', 'https://www.airbnb.com/calendar/ical/1483159189092150712.ics?s=41eaaab7ec67b79ad74e670c090270fc');
        };
    </script>
</body>
</html>
